<!DOCTYPE html>

<html>
<head>
  <title>angular-authentication.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="index.html">
                index.js
              </a>
            
              
              <a class="source" href="angular-authentication.html">
                angular-authentication.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>angular-authentication.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Authentication module for AngularJS<br>Copyright (C) 2013 Qloo Inc., Michael Diolosa <a href="&#109;&#x61;&#105;&#x6c;&#116;&#111;&#x3a;&#x6d;&#105;&#x63;&#x68;&#97;&#x65;&#x6c;&#x2e;&#x64;&#105;&#111;&#108;&#111;&#x73;&#97;&#x40;&#x67;&#109;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#109;">&#x6d;&#105;&#x63;&#x68;&#97;&#x65;&#x6c;&#x2e;&#x64;&#105;&#111;&#108;&#111;&#x73;&#97;&#x40;&#x67;&#109;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#109;</a><br>License: MIT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/*global angular:true, browser: true */</span>

(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  <span class="string">'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Private variable for storing identity information.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> _identity = {},</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Stores whether the user has been authenticated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _authenticated = <span class="literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2>authentication</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Provides the interface for conversing with the authentication API and
generating a principal from the authenticated entity&#39;s information.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    mod = angular.module(<span class="string">'authentication'</span>, [])</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2>Properties</h2>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .constant(<span class="string">'version'</span>, <span class="string">'1.0.4'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2>principal</h2>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>The authenticated entity, it&#39;s identity object is dynamically
generated when authentication is successful. It&#39;s properties are
generated by looping through the data that was returned by the
authentication API using the white list of property values that can
be configured through <code>authServiceProvider.identityKeys</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .factory(<span class="string">'principal'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> {
          identity: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> _identity; },
          isAuthenticated: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> _authenticated; }
        };
      })</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2>authority</h2>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>The <code>authority</code> provides a means for authentication</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .provider(<span class="string">'authority'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>An object that describes how the keys from the API&#39;s result are to be
translated into the identity object. The key of this object is the
key that is returned from the <code>authorize</code> method&#39;s data; the value of
this key is the key that it will exist as on the object that&#39;s
returned from <code>principal.identity()</code>.</p>
<p>An easier way to explain this is through some code:</p>
<p>We will assume that the authentication API returns a JSON object on
success that contains the following value:</p>
<pre><code>{
  &quot;username&quot;: &quot;mbrio&quot;,
  &quot;id:&quot;: 1001
  &quot;date&quot;: 1363784671793
}</code></pre>
<p>With the default values set to identityKeys then the object
returned from <code>principal.identity()</code> would be structured as:</p>
<pre><code>{
  name: function () { return &quot;mbrio&quot;; },
  id: function () { return 1001; }
}</code></pre>
<p>Which then could be used in an angular template if set to a <code>$scope</code>
property:</p>
<pre><code>$scope.user = principal // In the controller

{{user.identity().name}} // In the template</code></pre>
<p>As you see the <code>username</code> property on the JSON data was interpolated
to just <code>name</code>, <code>id</code> stayed the same, and <code>date</code> was ignored.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.identityKeys = {
          username: <span class="string">'name'</span>,
          id: <span class="string">'id'</span>
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Define the provider&#39;s instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.$get = [<span class="string">'$rootScope'</span>,
          <span class="function"><span class="keyword">function</span> <span class="params">($rootScope)</span> {</span>
            <span class="keyword">var</span> idKeys = <span class="keyword">this</span>.identityKeys;

            <span class="keyword">return</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><code>authorize</code> is meant to be called from a controller once the
user has been authenticated by an external API. It wires up the
<code>principal.identity()</code> object and then broadcasts the
<code>authority-authorized</code> event from the <code>$rootScope</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              authorize: <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> {</span>
                <span class="keyword">var</span> key, propertyFn;
                _authenticated = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Fill our <code>principal.identity()</code> object with getter methods
to protect the underlying values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                propertyFn = <span class="function"><span class="keyword">function</span> <span class="params">(k)</span> {</span>
                  <span class="keyword">var</span> value = idKeys[k],
                    retval = data[k],
                    ident = {};

                  _identity[value] = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> retval; };
                };

                <span class="keyword">for</span> (key <span class="keyword">in</span> idKeys) {
                  <span class="keyword">if</span> (idKeys.hasOwnProperty(key) &amp;&amp; data.hasOwnProperty(key)) {
                    propertyFn(key);
                  }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Broadcast the authorized event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.$broadcast(<span class="string">'event:authority-authorized'</span>);
              },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><code>deauthorize</code> resets the <code>principal</code> and <code>identity</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              deauthorize: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
                <span class="keyword">var</span> key, value;
                _authenticated = <span class="literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Delete all the properties of <code>_identity</code> for a clean slate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">for</span> (key <span class="keyword">in</span> idKeys) {
                  value = idKeys[key];
                  <span class="keyword">if</span> (idKeys.hasOwnProperty(key) &amp;&amp; _identity.hasOwnProperty(value)) {
                    <span class="keyword">delete</span> _identity[value];
                  }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Broadcast the deauthorized event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.$broadcast(<span class="string">'event:authority-deauthorized'</span>);
              }
            };
          }];
      });
}());</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
